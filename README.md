# SkyStack

Small automation toolkit for stacking and calibrating astrophotography FITS frames using PixInsight CLI.

## Quick overview

- Transfer/organize frames from Dropbox: [auto_transfer.py](auto_transfer.py)  
- Build master calibration frames (flats/darks): [stack_flats.py](stack_flats.py), [stack_darks.py](stack_darks.py) which reuse shared logic in [stack_calibration_frames.py](stack_calibration_frames.py)  
- Calibrate light frames and create reports/plots: [calibrate_images.py](calibrate_images.py)  
- PixInsight automation JS scripts used by the CLI wrapper: [pixscripts/basic_stack_script.js](pixscripts/basic_stack_script.js), [pixscripts/calibration_script.js](pixscripts/calibration_script.js)

Core helpers are in the `astro_utils` package:
- Config loader: [`astro_utils.config_loader.load_config`](astro_utils/config_loader.py) ([file](astro_utils/config_loader.py))  
- File operations: [`astro_utils.file_ops.ensure_dir`](astro_utils/file_ops.py), [`astro_utils.file_ops.get_target_name`](astro_utils/file_ops.py) ([file](astro_utils/file_ops.py))  
- FITS header helpers: [`astro_utils.fits_helpers.read_fits_header_info`](astro_utils/fits_helpers.py) ([file](astro_utils/fits_helpers.py))  
- PixInsight CLI wrapper: [`astro_utils.pixinsight_cli.stack_with_pixinsight`](astro_utils/pixinsight_cli.py), [`astro_utils.pixinsight_cli.calibrate_with_pixinsight`](astro_utils/pixinsight_cli.py) (`astro_utils/pixinsight_cli.py`)

Config file: [config.yaml](config.yaml) â€” edit paths, tolerances and behavior there (PixInsight CLI path, base directories, tolerances, etc.).

## Requirements

- Python 3.8+
- Packages (example): astropy, numpy, matplotlib, pandas, pyyaml
Install with pip, e.g.:
```sh
pip install astropy numpy matplotlib pandas pyyaml
```

## Usage
- Ensure config.yaml is configured for your environment (paths, PIXInsight path, directories).
- Transfer files from Dropbox:
  ```
  python auto_transfer.py
  ```
- Create master flats/darks:
    ```
    python stack_flats.py
    python stack_darks.py
    ```
    Masters are produced in the directories set by flat_master_output / dark_master_output in `config.yaml`.
- Calibrate lights and generate summary plots:
    ```
    python calibrate_images.py
    ```
    or call `plot_summary()` directly on an existing calibration log JSON found in each calibrated target folder.


## Notes & pointers
- PixInsight execution: the wrapper writes JSON into C:/Temp/PixStack and runs PixInsight with `--run` pointing to the JS scripts. Verify the PixInsight executable path in `config.yaml` and/or `astro_utils.pixinsight_cli.PIXINSIGHT_PATH`.
- The JS scripts read JSON files generated by the Python wrappers: `input_files.json` and `params.json` in `C:/Temp/PixStack`.
Logging: scripts use Python logging; change `log_level` in `config.yaml`.
If you need to adapt grouping/metadata logic, see `astro_utils.fits_helpers.read_fits_header_info` and `stack_calibration_frames.stack`.